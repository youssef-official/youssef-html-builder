<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Project Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b1020;
  --panel:#020617;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#f472b6;
}

*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  display:flex;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* LAYOUT */
.sidebar{
  width:260px;
  background:var(--panel);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
}
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  font-weight:600;
}

/* FILE TREE */
.tree{
  flex:1;
  padding:12px;
  overflow:auto;
  font-size:13px;
}
.file{
  padding:4px 8px;
  cursor:pointer;
  border-radius:6px;
}
.file:hover{background:#1e293b}

/* CONTENT */
.content{
  flex:1;
  display:flex;
}
.editor, .preview{
  flex:1;
  border-left:1px solid var(--border);
}
pre{
  margin:0;
  padding:16px;
  height:100%;
  overflow:auto;
  background:#020617;
  font-size:13px;
}
iframe{
  width:100%;
  height:100%;
  border:none;
  background:white;
}

/* CHAT */
.chat{
  height:180px;
  border-top:1px solid var(--border);
  display:flex;
  flex-direction:column;
}
.chat-log{
  flex:1;
  padding:10px;
  overflow:auto;
  font-size:13px;
}
.chat-log div{margin-bottom:6px}
.chat-input{
  display:flex;
  border-top:1px solid var(--border);
}
.chat-input input{
  flex:1;
  padding:10px;
  background:var(--panel);
  border:none;
  color:var(--text);
}
.chat-input button{
  background:var(--accent);
  border:none;
  padding:0 18px;
  cursor:pointer;
}

/* FOOTER */
footer{
  padding:10px;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-between;
}
button{
  background:#1e293b;
  border:none;
  color:var(--text);
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="sidebar">
  <header>üìÅ Project Files</header>
  <div class="tree" id="fileTree"></div>
</div>

<div class="main">
  <header>AI Project Studio</header>

  <div class="content">
    <div class="editor">
      <pre id="editor">// Select a file</pre>
    </div>
    <div class="preview">
      <iframe id="preview"></iframe>
    </div>
  </div>

  <div class="chat">
    <div class="chat-log" id="chatLog"></div>
    <div class="chat-input">
      <input id="chatInput" placeholder="ÿßÿπŸÖŸÑ ŸÖŸàŸÇÿπ ŸÉÿßŸÅŸäŸá ŸÉÿßŸÖŸÑ / ÿπÿØŸÑ ÿµŸÅÿ≠ÿ© / ÿ≤ŸàÿØ CSS..." />
      <button onclick="send()">Send</button>
    </div>
  </div>

  <footer>
    <button onclick="exportZip()">Export ZIP</button>
    <button onclick="reset()">New Project</button>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
const MODEL="mistralai/devstral-2512:free";
let apiKey=localStorage.getItem("OPENROUTER_KEY")||prompt("Enter OpenRouter API Key");
localStorage.setItem("OPENROUTER_KEY",apiKey);

let files={};
let selectedFile=null;

const SYSTEM = `
You are a senior frontend architect.

Return ONLY a JSON object representing a FULL website project.

Rules:
- Keys = file paths (folders allowed)
- Values = file contents
- Include:
  - index.html
  - assets/css/style.css
  - assets/js/main.js
- Use modern, professional, classic design.
- No markdown.
- No explanations.
`;

function renderTree(){
  fileTree.innerHTML="";
  Object.keys(files).forEach(f=>{
    const d=document.createElement("div");
    d.className="file";
    d.textContent=f;
    d.onclick=()=>openFile(f);
    fileTree.appendChild(d);
  });
}

function openFile(f){
  selectedFile=f;
  editor.textContent=files[f];
}

function buildPreview(){
  if(!files["index.html"])return;
  let html=files["index.html"];
  html=html.replace("</head>",`
<link rel="stylesheet" href="assets/css/style.css">
</head>`);
  html=html.replace("</body>",`
<script>${files["assets/js/main.js"]||""}<\/script>
</body>`);
  preview.srcdoc=html;
}

async function send(){
  const msg=chatInput.value.trim();
  if(!msg)return;
  chatInput.value="";
  chatLog.innerHTML+=`<div>üßë ${msg}</div>`;

  const prompt = Object.keys(files).length
    ? JSON.stringify(files)+ "\n\nModify project: " + msg
    : msg;

  const res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+apiKey,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      model:MODEL,
      messages:[
        {role:"system",content:SYSTEM},
        {role:"user",content:prompt}
      ],
      max_tokens:8000
    })
  });

  const json=await res.json();
  files=JSON.parse(json.choices[0].message.content);

  renderTree();
  buildPreview();
  chatLog.innerHTML+=`<div>ü§ñ Project updated</div>`;
}

function exportZip(){
  const zip=new JSZip();
  Object.keys(files).forEach(f=>zip.file(f,files[f]));
  zip.generateAsync({type:"blob"}).then(b=>{
    const a=document.createElement("a");
    a.href=URL.createObjectURL(b);
    a.download="project.zip";
    a.click();
  });
}

function reset(){
  files={};
  renderTree();
  editor.textContent="";
  preview.srcdoc="";
}
</script>

</body>
</html>