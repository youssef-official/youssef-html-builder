<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Project Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b1020;
  --panel:#020617;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#f472b6;
}

*{box-sizing:border-box}

body{
  margin:0;
  height:100vh;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
}

/* APP LAYOUT */
.app{
  flex:1;
  display:flex;
  flex-direction:column;
}

.view{
  flex:1;
  display:none;
}
.view.active{display:block}

/* PREVIEW */
iframe{
  width:100%;
  height:100%;
  border:none;
  background:white;
}

/* CODE VIEW */
pre{
  margin:0;
  height:100%;
  padding:16px;
  background:var(--panel);
  overflow:auto;
  white-space:pre-wrap;
  font-size:13px;
}

/* CHAT */
.chat{
  height:100%;
  display:flex;
  flex-direction:column;
}
.chat-log{
  flex:1;
  padding:12px;
  overflow:auto;
  font-size:14px;
}
.chat-log div{margin-bottom:8px}
.chat-input{
  display:flex;
  border-top:1px solid var(--border);
}
.chat-input input{
  flex:1;
  padding:12px;
  background:var(--panel);
  border:none;
  color:var(--text);
}
.chat-input button{
  background:var(--accent);
  border:none;
  padding:0 18px;
  cursor:pointer;
}

/* BOTTOM NAV */
.nav{
  height:64px;
  background:var(--panel);
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-around;
  align-items:center;
}
.nav button{
  background:none;
  border:none;
  color:var(--muted);
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:11px;
  cursor:pointer;
}
.nav button.active{color:var(--accent)}
.nav svg{width:22px;height:22px;fill:currentColor}
</style>
</head>

<body>

<div class="app">

  <!-- PREVIEW -->
  <div class="view active" id="previewView">
    <iframe id="preview"></iframe>
  </div>

  <!-- CODE -->
  <div class="view" id="codeView">
    <pre id="code">// Code will appear here</pre>
  </div>

  <!-- CHAT -->
  <div class="view" id="chatView">
    <div class="chat">
      <div class="chat-log" id="chatLog"></div>
      <div class="chat-input">
        <input id="chatInput" placeholder="Ø§Ø¹Ù…Ù„ Ù…ÙˆÙ‚Ø¹ / Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹..." />
        <button onclick="send()">Send</button>
      </div>
    </div>
  </div>

</div>

<!-- BOTTOM NAV -->
<div class="nav">
  <button class="active" onclick="switchView('preview')">
    <svg viewBox="0 0 24 24"><path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7z"/></svg>
    Preview
  </button>
  <button onclick="switchView('code')">
    <svg viewBox="0 0 24 24"><path d="M8 17l-5-5 5-5M16 7l5 5-5 5"/></svg>
    Code
  </button>
  <button onclick="switchView('chat')">
    <svg viewBox="0 0 24 24"><path d="M4 4h16v12H6l-2 2z"/></svg>
    Chat
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
const MODEL="mistralai/devstral-2512:free";
let apiKey=localStorage.getItem("OPENROUTER_KEY") || prompt("Enter OpenRouter API Key");
localStorage.setItem("OPENROUTER_KEY",apiKey);

let project={};

/* ðŸ”¥ SYSTEM PROMPT (Ù‚Ø§Ø³ÙŠ Ø¬Ø¯Ù‹Ø§) */
const SYSTEM = `
You are a senior frontend architect and UI designer.

TASK:
Generate or modify a FULL professional website project.

OUTPUT FORMAT:
Return ONLY a valid JSON object.
Keys = file paths.
Values = file contents.

RULES:
- Multi-page project.
- Separate HTML, CSS, JS files.
- Professional, classic, commercial design.
- Clean typography, spacing, layout.
- No markdown.
- No explanations.
- No comments outside files.

QUALITY BAR:
Must look like a real business website.
`;

/* UI */
function switchView(v){
  document.querySelectorAll(".view").forEach(x=>x.classList.remove("active"));
  document.getElementById(v+"View").classList.add("active");
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".nav button")[["preview","code","chat"].indexOf(v)].classList.add("active");
}

/* BUILD PREVIEW */
function buildPreview(){
  if(!project["index.html"]) return;
  let html = project["index.html"];
  if(project["assets/css/style.css"]){
    html = html.replace("</head>", `<style>${project["assets/css/style.css"]}</style></head>`);
  }
  if(project["assets/js/main.js"]){
    html = html.replace("</body>", `<script>${project["assets/js/main.js"]}<\/script></body>`);
  }
  preview.srcdoc = html;
}

/* SHOW CODE */
function buildCode(){
  let out="";
  Object.keys(project).forEach(f=>{
    out+=`// ===== ${f} =====\n${project[f]}\n\n`;
  });
  code.textContent=out || "// No code yet";
}

/* CHAT */
async function send(){
  const msg=chatInput.value.trim();
  if(!msg)return;
  chatInput.value="";
  chatLog.innerHTML+=`<div>ðŸ§‘ ${msg}</div>`;

  const prompt = Object.keys(project).length
    ? JSON.stringify(project)+ "\n\nModify project: " + msg
    : msg;

  const res = await fetch("https://openrouter.ai/api/v1/chat/completions",{
    method:"POST",
    headers:{
      "Authorization":"Bearer "+apiKey,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      model:MODEL,
      messages:[
        {role:"system",content:SYSTEM},
        {role:"user",content:prompt}
      ],
      max_tokens:8000
    })
  });

  const data = await res.json();
  project = JSON.parse(data.choices[0].message.content);

  buildPreview();
  buildCode();
  chatLog.innerHTML+=`<div>ðŸ¤– Project ready</div>`;
}
</script>

</body>
</html>